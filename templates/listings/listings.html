{% extends 'core/base.html' %}
{% load static %}
{% load humanize %}

{% block extrastyle %}
<style>
  /* Listings Page Styles */
  .listings-hero {
    background: linear-gradient(rgba(10, 22, 40, 0.85), rgba(10, 22, 40, 0.9)), 
                url('../img/building.jpg');
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    padding: 3rem 0;
  }
  
  .listings-hero h1 {
    color: white;
    font-weight: 800;
    margin-bottom: 1.5rem;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  
  .results-header {
    background: white;
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-md);
  }
  
  .results-count {
    font-size: 1.1rem;
    color: var(--gray-700);
    font-weight: 600;
  }
  
  .results-count strong {
    color: var(--accent-green);
    font-size: 1.4rem;
  }
  
  /* Empty State */
  .empty-listings {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-md);
  }
  
  .empty-listings i {
    font-size: 5rem;
    color: var(--gray-400);
    margin-bottom: 1.5rem;
  }
  
  .empty-listings h3 {
    color: var(--gray-700);
    margin-bottom: 1rem;
  }
  
  .empty-listings p {
    color: var(--gray-600);
    font-size: 1.1rem;
    margin-bottom: 2rem;
  }
  
  /* Pagination Styles */
  .custom-pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 3rem;
    padding: 2rem 0;
    flex-wrap: wrap;
  }
  
  .custom-pagination .page-item {
    list-style: none;
  }
  
  .custom-pagination .page-link {
    border: 2px solid var(--gray-300);
    border-radius: var(--radius-md);
    padding: 0.75rem 1rem;
    color: var(--gray-700);
    font-weight: 600;
    transition: var(--transition-base);
    text-decoration: none;
    display: inline-block;
    min-width: 45px;
    text-align: center;
    background: white;
  }
  
  .custom-pagination .page-link:hover {
    background: var(--accent-green);
    border-color: var(--accent-green);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }
  
  .custom-pagination .page-item.active .page-link {
    background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-dark) 100%);
    border-color: var(--accent-green);
    color: white;
    box-shadow: var(--shadow-md);
  }
  
  .custom-pagination .page-item.disabled .page-link {
    background: var(--gray-100);
    border-color: var(--gray-200);
    color: var(--gray-400);
    cursor: not-allowed;
    opacity: 0.6;
  }
  
  .custom-pagination .page-item.disabled .page-link:hover {
    transform: none;
    box-shadow: none;
    background: var(--gray-100);
    border-color: var(--gray-200);
    color: var(--gray-400);
  }
  
  @media (max-width: 768px) {
    .custom-pagination .page-link {
      padding: 0.5rem 0.75rem;
      min-width: 40px;
      font-size: 0.9rem;
    }
  }
</style>
{% endblock %}

{% block content %}

<!-- Hero Section with Search -->
<section class="listings-hero">
  <div class="container">
    <div class="bg-blur-all p-4 p-md-5">
      <div class="text-center mb-4">
        <h1 class="display-4">{{ title|default:"Browse Properties" }}</h1>
      </div>
      
      <!-- Search Form -->
      {% include 'core/partials/_search.html' %}
    </div>
  </div>
</section>

<!-- Breadcrumb -->
<section id="bc" class="py-3 bg-light">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent mb-0">
        <li class="breadcrumb-item">
          <a href="{% url 'index' %}">
            <i class="fas fa-home"></i> {{ _("Home") }}
          </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
          {{ _("Browse Listings") }}
        </li>
      </ol>
    </nav>
  </div>
</section>

<!-- Listings Section -->
<section id="listings" class="py-5 bg-light">
  <div class="container">
    
    {% if listings %}
    
    <!-- Results Header -->
    <div class="results-header text-center">
      <div class="results-count">
        <i class="fas fa-home mr-2 text-success"></i>
        <strong>{{ listings.paginator.count }}</strong> 
        {% if listings.paginator.count == 1 %}
          {{ _("Property Found") }}
        {% else %}
          {{ _("Properties Found") }}
        {% endif %}
      </div>
    </div>

    <!-- Property Grid -->
    <div class="row">
      {% for listing in listings %}
        {% include 'listings/_partials/_listing-box.html' %}
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if listings.has_other_pages %}
    <div class="row">
      <div class="col-12">
        <nav aria-label="Property listings pagination">
          <ul class="custom-pagination">
            
            <!-- Previous Button -->
            {% if listings.has_previous %}
            <li class="page-item">
              <a href="?page={{ listings.previous_page_number }}" 
                 class="page-link"
                 aria-label="Previous page">
                &laquo;
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&laquo;</span>
            </li>
            {% endif %}

            <!-- Page Numbers -->
            {% for i in listings.paginator.page_range %}
              {% if listings.number == i %}
              <li class="page-item active" aria-current="page">
                <span class="page-link">{{ i }}</span>
              </li>
              {% else %}
              <li class="page-item">
                <a href="?page={{ i }}" class="page-link">{{ i }}</a>
              </li>
              {% endif %}
            {% endfor %}

            <!-- Next Button -->
            {% if listings.has_next %}
            <li class="page-item">
              <a href="?page={{ listings.next_page_number }}" 
                 class="page-link"
                 aria-label="Next page">
                &raquo;
              </a>
            </li>
            {% else %}
            <li class="page-item disabled">
              <span class="page-link">&raquo;</span>
            </li>
            {% endif %}

          </ul>
        </nav>
        
        <!-- Page Info -->
        <div class="text-center mt-3 text-muted">
          {{ _("Page") }} <strong>{{ listings.number }}</strong> 
          {{ _("of") }} <strong>{{ listings.paginator.num_pages }}</strong>
        </div>
      </div>
    </div>
    {% endif %}

    {% else %}
    
    <!-- Empty State -->
    <div class="row">
      <div class="col-12">
        <div class="empty-listings">
          <i class="fas fa-search"></i>
          <h3>{{ _("No Listings Available") }}</h3>
          <p>{{ _("Check back later for new properties.") }}</p>
          <a href="{% url 'index' %}" class="btn btn-success btn-lg">
            <i class="fas fa-home mr-2"></i>
            {{ _("Go Home") }}
          </a>
        </div>
      </div>
    </div>
    
    {% endif %}

  </div>
</section>

{% endblock %}