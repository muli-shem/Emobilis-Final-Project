{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}
{% load filters %}
{% load humanize %}

{% block content %}

{% include 'core/partials/_showcase_section.html' %}

<!-- Breadcrumb -->
<section id="bc" class="mt-4">
  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb bg-transparent px-0">
        <li class="breadcrumb-item">
          <a href="{% url 'index' %}" class="text-primary">{{ _("Home") }}</a>
        </li>
        <li class="breadcrumb-item">
          <a href="{% url 'listings' %}" class="text-primary">{{ _("Listings") }}</a>
        </li>
        <li class="breadcrumb-item active">{{ listing.title }}</li>
      </ol>
    </nav>
  </div>
</section>

<!-- Alerts -->
{% include 'core/partials/_alerts.html' %}

<!-- Listing -->
<section id="listing" class="py-4">
  <div class="container">

    <!-- Action Buttons -->
    <div class="row mb-4">
      <div class="col-md-6 mb-2 mb-md-0">
        <a href="{% url 'listings' %}" class="btn btn-outline-primary">
          <i class="fas fa-arrow-left mr-2"></i>{{ _("Back To Listings") }}
        </a>
      </div>
      <div class="col-md-6 text-md-right">
        {% if user.is_authenticated %}
          {% if user.is_staff %}
            <a href="{% url 'admin:listings_listing_change' listing.id %}" target="_blank"
              class="btn btn-info">
              <i class="fas fa-edit mr-2"></i>Edit
            </a>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <!-- FULL WIDTH CONTENT -->
    <div class="row">
      <div class="col-12">
        <!-- Property Title & Location -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">
            <h1 class="h2 mb-3 font-weight-bold">{{ listing.title }}</h1>
            <p class="text-muted mb-2">
              <i class="fas fa-map-marker-alt text-primary mr-2"></i>
              {{ listing.address }}
            </p>
            <div class="d-flex align-items-center flex-wrap">
              <h3 class="text-primary mb-0 font-weight-bold mr-3">{{ listing.price | intcomma }} €</h3>
              <span class="badge badge-secondary px-3 py-2">
                {% if listing.protected %}
                  <i class="fas fa-shield-alt mr-1"></i>{{ _("Protected Listing") }}
                {% else %}
                  {{ _("Standard Listing") }}
                {% endif %}
              </span>
            </div>
          </div>
        </div>

        <!-- Main Image -->
        <div class="card border-0 shadow-sm mb-4 overflow-hidden">
          <img src="{{ listing.image.url }}" alt="{{ listing.title }}" class="img-fluid w-100" style="max-height: 600px; object-fit: cover;">
        </div>

        <!-- Image Gallery -->
        {% if listing.listingimage_set.all %}
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-3">
            <h5 class="mb-3 font-weight-bold">{{ _("Gallery") }}</h5>
            <div class="row">
              {% for img in listing.listingimage_set.all %}
              <div class="col-6 col-md-4 col-lg-2 mb-3">
                <a href="{{ img.image.url }}" data-lightbox="home-images" class="d-block">
                  <img src="{{ img.image.url }}" alt="" class="img-fluid rounded shadow-sm" style="height: 120px; width: 100%; object-fit: cover; transition: transform 0.3s;">
                </a>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        {% endif %}

        <!-- Description -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">
            <h4 class="mb-3 font-weight-bold">{{ _("Description") }}</h4>
            <p class="text-muted" style="line-height: 1.8;">{{ listing.description }}</p>
          </div>
        </div>

        <!-- Property Features -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">
            <h4 class="mb-4 font-weight-bold">{{ _("Property Features") }}</h4>
            <div class="row">
              <!-- Column 1 -->
              <div class="col-md-6 mb-3">
                <ul class="list-unstyled">
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-bed text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Bedrooms") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.bedrooms }}</span>
                    </div>
                  </li>
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-bath text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Bathrooms") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.bathrooms }}</span>
                    </div>
                  </li>
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-car text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Garage") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.garage }}</span>
                    </div>
                  </li>
                  <li class="p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-arrows-alt-v text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Ceiling Height") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.ceiling_height }} {{ _("m") }}</span>
                    </div>
                  </li>
                </ul>
              </div>

              <!-- Column 2 -->
              <div class="col-md-6 mb-3">
                <ul class="list-unstyled">
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-th-large text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Square Feet") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.sqft }} {{ _("m²") }}</span>
                    </div>
                  </li>
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-square text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Lot Size") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.lot_size }} {{ _("m²") }}</span>
                    </div>
                  </li>
                  <li class="mb-3 p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-calendar text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Available From") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.free_date }}</span>
                    </div>
                  </li>
                  <li class="p-3 bg-light rounded">
                    <div class="d-flex justify-content-between align-items-center">
                      <span>
                        <i class="fas fa-clock text-primary mr-2" style="width: 20px;"></i>
                        <strong>{{ _("Listed On") }}</strong>
                      </span>
                      <span class="badge badge-primary badge-pill px-3 py-2">{{ listing.created|date:"d M Y" }}</span>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <!-- Location Map -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body p-4">
            <h4 class="mb-3 font-weight-bold">{{ _("Location") }}</h4>
            <div id="map" class="rounded" style="width:100%;height:400px;"></div>
          </div>
        </div>

        <!-- REALTOR CONTACT BOX - FULL WIDTH BELOW CONTENT -->
        <div class="card border-0 shadow-lg mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <div class="card-body p-0">
            {% include 'contacts/_partials/_realtor-contact-box.html' %}
          </div>
        </div>

      </div>
    </div>

  </div>
</section>

<style>
  /* Custom styles for enhanced UI */
  .breadcrumb-item + .breadcrumb-item::before {
    content: "›";
    font-size: 1.2em;
  }
  
  .card {
    transition: transform 0.2s;
  }
  
  .img-fluid:hover {
    transform: scale(1.02);
  }
  
  .badge-pill {
    font-size: 0.9rem;
    font-weight: 500;
  }
  
  .bg-light {
    background-color: #f8f9fa !important;
  }
  
  .shadow-sm {
    box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important;
  }

  /* Gallery hover effect */
  .col-6 a img:hover,
  .col-md-4 a img:hover,
  .col-lg-2 a img:hover {
    transform: scale(1.05);
    box-shadow: 0 .5rem 1rem rgba(0,0,0,.15) !important;
  }
</style>

<script>
  function myMap() {
    const myLatLng = {
      lat: {{ listing.get_coordinates.latitude|stringformat:"f"}},
      lng: {{ listing.get_coordinates.longitude|stringformat:"f" }}
    };
    var mapProp = { 
      center: new google.maps.LatLng(myLatLng), 
      zoom: 14,
      styles: [
        {
          featureType: "poi",
          elementType: "labels",
          stylers: [{ visibility: "off" }]
        }
      ]
    };
    var map = new google.maps.Map(document.getElementById("map"), mapProp);
    const marker = new google.maps.Marker({
      position: myLatLng,
      map,
      title: "{{ listing.get_coordinates.address }}",
      animation: google.maps.Animation.DROP
    });
  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=[YOUR-API-KEY]&callback=myMap"></script>

{% endblock %}